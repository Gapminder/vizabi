(function(){"use strict";function a(a,b,d){var e=c.Tool.get(a);if(e){var f=new e(b,d);return c._instances[f._id]=f,f}c.utils.error('Tool "'+a+'" was not found.')}var b=this,c=(b.Vizabi,function(b,c,d){return a(b,c,d)});c._instances={},c.clearInstances=function(a){a?delete c._instances[a]:c._instances={}},c._require=function(a){return"undefined"==typeof b[a]?(c.utils.warn(a+" is required and could not be found."),!1):!0},"function"==typeof define&&define.amd?define(function(){return c}):"object"==typeof module&&module.exports&&(module.exports=c),b.Vizabi=c}).call(this),function(){"use strict";var a=this,b=a.Vizabi;b.utils={uniqueId:function(){var a=0;return function(b){return b?b+a++:a++}}(),isElement:function(a){return!(!a||1!==a.nodeType)},isArray:Array.isArray||function(a){return"[object Array]"===toString.call(a)},isObject:function(a){var b=typeof a;return"object"===b&&!!a},isDate:function(a){return a instanceof Date},isPlainObject:function(a){return null!=a&&"[object Object]"===Object.prototype.toString.call(a)},forEach:function(a,b,c){if(a)if(this.isArray(a)){var d;for(d=0;d<a.length&&b.apply(c,[a[d],d])!==!1;d++);}else for(var e in a)if(b.apply(c,[a[e],e])===!1)break},extend:function(a){var b=Array.prototype.slice.call(arguments,1),c=this;return this.forEach(b,function(b,d){c.forEach(b,function(c,d){b.hasOwnProperty(d)&&(a[d]=c)})}),a},merge:function(a){var b=Array.prototype.slice.call(arguments,1),c=this;return this.forEach(b,function(b,d){c.forEach(b,function(d,e){b.hasOwnProperty(e)&&(a.hasOwnProperty(e)?(c.isArray(a[e])||(a[e]=[a[e]]),a[e].push(d)):a[e]=d)})}),a},clone:function(a,b){var c={};return this.forEach(a,function(d,e){b&&-1===b.indexOf(e)||a.hasOwnProperty(e)&&(c[e]=d)}),c},deepClone:function(a){var b={},c=this;return this.forEach(a,function(d,e){a.hasOwnProperty(e)&&(c.isObject(d)||c.isArray(d)?b[e]=c.deepClone(d):b[e]=d)}),b},without:function(a,b){var c=a.indexOf(b);return-1!==c&&a.splice(c,1),a},unique:function(a,b){var c={},d=[];b||(b=function(a){return a});for(var e=0,f=a.length;f>e;++e){var g=b(a[e]);c.hasOwnProperty(g)||(d.push(a[e]),c[g]=1)}return d},find:function(a,b){var c;return this.forEach(a,function(a){return b(a)?(c=a,!1):void 0}),c},filter:function(a,b){return a.filter(function(a){for(var c in b)if(a[c]!==b[c])return!1;return!0})},timeStamp:function(b){a.console&&"function"==typeof a.console.timeStamp&&a.console.timeStamp(b)},warn:function(b){a.console&&"function"==typeof a.console.warn&&a.console.warn(b)},groupCollapsed:function(b){a.console&&"function"==typeof a.console.groupCollapsed&&a.console.groupCollapsed(b)},groupEnd:function(){a.console&&"function"==typeof a.console.groupEnd&&a.console.groupEnd()},error:function(b){a.console&&"function"==typeof a.console.error&&a.console.error(b)},countDecimals:function(a){return Math.floor(a.valueOf())===a.valueOf()?0:a.toString().split(".")[1].length||0},addClass:function(a,b){a.classList?a.classList.add(b):a.className+=" "+b},removeClass:function(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")},throttle:function(){var a={};return function(b,c){a[b]||(a[b]=!0,setTimeout(function(){a[b]=!1},c),b())}}(),hasClass:function(a,b){return a.classList?a.classList.contains(b):new RegExp("(^| )"+b+"( |$)","gi").test(a.className)},values:function(a){var b;for(var c in a)(b=b||[]).push(a[c]);return b},defer:function(a){setTimeout(a,1)},ajax:function(a){var b=new XMLHttpRequest;b.open(a.method,a.url,!0),"POST"===a.method&&b.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),b.onload=function(){if(b.status>=200&&b.status<400){var c=a.json?JSON.parse(b.responseText):b.responseText;a.success&&a.success(c)}else a.error&&a.error()},b.onerror=function(){a.error&&a.error()},b.send(a.data)},get:function(a,b,c,d,e){var b=[];this.forEach(b,function(a,c){b.push(c+"="+a)}),a=b.length?a+"?"+b.join("&"):a,this.ajax({method:"GET",url:a,success:c,error:d,json:e})},post:function(a,b,c,d,e){this.ajax({method:"POST",url:a,success:c,error:d,json:e,data:b})}}}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils;!function(a,b){"undefined"!=typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Promise=b.call(a)}(b,function(){function a(b){return this instanceof a?(this.status="pending",this.value,this.reason,this._resolves=[],this._rejects=[],g(b)&&b(this.resolve.bind(this),this.reject.bind(this)),this):new a(b)}function b(b,c){return c===b&&b.reject(new Error("TypeError")),c instanceof a?d(b,c):i(c)?e(b,c):b.resolve(c)}function d(a,b){var c=b.status;return"pending"===c&&b.then(a.resolve.bind(a),a.reject.bind(a)),"resolved"===c&&a.resolve(b.value),"rejected"===c&&a.reject(b.reason),promise}function e(a,c){var d,e=j(function(c){d||(b(a,c),d=!0)}),f=j(function(b){d||(a.reject(b),d=!0)});try{c.then.call(c,e,f)}catch(g){if(!d)throw g;a.reject(g)}return a}function f(a){for(var c,d,e=a.status,f=a["resolved"===e?"_resolves":"_rejects"],g=a["resolved"===e?"value":"reason"];c=f.shift();)d=c.call(a,g),d&&b(a._next,d);return a}function g(a){return"function"===h(a)}function h(a){var b={};return b.toString.call(a).replace(/\[object (\w+)\]/,"$1").toLowerCase()}function i(a){return a&&a.then&&g(a.then)}function j(a){var b,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}}return a.prototype.then=function(c,d){var e,f=this._next||(this._next=a()),h=this.status;if("pending"===h)return g(c)&&this._resolves.push(c),g(d)&&this._rejects.push(d),f;if("resolved"===h){if(g(c))try{e=c(this.value),b(f,e)}catch(i){this.reject(i)}else f.resolve(c);return f}if("rejected"===h){if(g(d))try{e=d(this.reason),b(f,e)}catch(i){this.reject(i)}else f.reject(d);return f}},a.prototype.resolve=function(a){if("rejected"===this.status)throw Error("Illegal call.");return this.status="resolved",this.value=a,this._resolves.length&&f(this),this},a.prototype.reject=function(a){if("resolved"===this.status)throw Error("Illegal call.");return this.status="rejected",this.reason=a,this._rejects.length&&f(this),this},a.prototype["catch"]=function(a){return this.then(void 0,a)},a.cast=function(b){var c=a();return b instanceof a?d(c,b):a.resolve(b)},a.resolve=function(b){var c=a();return i(b)?e(c,b):c.resolve(b)},a.all=function(b){var d,e=b.length,f=a(),g=[],h=0;return c.forEach(b,function(a,b){a.then(function(a){g[b]=a,++h!==e||d||f.resolve(g)},function(a){d=!0,f.reject(a)})}),f},a.any=function(b){var d,e=a();return c.forEach(b,function(a,b){a.then(function(a){d||(e.resolve(a),d=!0)},function(a){d=!0,e.reject(a)})}),e},a.reject=function(b){if(!(b instanceof Error))throw Error("reason must be an instance of Error");var c=a();return c.reject(b),c},a})}.call(this),function(){"use strict";function a(b,f){function g(){!d&&this.init&&this.init.apply(this,arguments)}f=1===arguments.length?b:f;var h=this.prototype;d=!0;var i=new this;return d=!1,c.utils.forEach(f,function(a,b){"function"==typeof f[b]&&"function"==typeof h[b]&&e.test(f[b])?i[b]=function(a,b){return function(){var c=this._super;this._super=h[a];var d=b.apply(this,arguments);return this._super=c,d}}(b,f[b]):i[b]=a}),g.prototype=i,g.prototype.constructor=g,g.extend=a,g._collection={},g.register=function(a,b){"undefined"!=typeof this._collection[a]&&c.utils.warn('"'+a+'" is already registered. Overwriting...'),this._collection[a]=b},g.unregister=function(a){delete this._collection[a]},g.getCollection=function(){return this._collection},g.get=function(a,b){return this._collection.hasOwnProperty(a)?this._collection[a]:(b||c.utils.warn('"'+a+'" was not found.'),!1)},arguments.length>1&&this.register&&this.register(b,g),g}var b=this,c=b.Vizabi,d=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;c.Class=function(){},c.Class.extend=a}.call(this),function(){"use strict";function a(a,b,c){return JSON.stringify(a)+b+JSON.stringify(c)}var b=this,c=b.Vizabi,d=c.utils,e=c.Promise,f={},g=c.Class.extend({init:function(){this._data={}},load:function(a,b,c,f){var g=this,h=new e,i=e.all([]),j=this.isCached(a,b,c),k=!1;return j||(d.timeStamp("Vizabi Data: Loading Data"),f&&"function"==typeof f.load_start&&f.load_start(),i=new e,this.loadFromReader(a,b,c).then(function(a){k=!0,j=a,i.resolve()})),i.then(function(){var a=g.get(j);h.resolve(a),k&&f&&"function"==typeof f.load_end&&f.load_end()},function(){h.reject("Error loading file..."),k&&f&&"function"==typeof f.load_end&&f.load_end()}),h},loadFromReader:function(b,c,g){var h=this,i=new e,j=g.reader,k=a(b,c,g);if(!f.hasOwnProperty(j))return void d.error("Vizabi Reader "+j+" not found");var l=new f[j](g);return l.read(b,c).then(function(){var a=l.getData(),c=b,d=-1!==c.select.indexOf("geo.region");a=a.map(function(a){for(var b=0;b<c.select.length;b++){var d=c.select[b];"undefined"==typeof a[d]&&(a[d]=null)}return a}),a=a.map(function(a){return null===a.geo&&(a.geo=a["geo.name"]),d&&null===a["geo.region"]&&(a["geo.region"]=a.geo),a}),a=a.map(function(a){return a.time=new Date(a.time),a.time.setHours(0),a}),a.sort(function(a,b){return a.time-b.time}),h._data[k]=a,i.resolve(k)},function(a){i.reject(a)}),i},get:function(a){return a?this._data[a]:this._data},isCached:function(b,c,d){var e=a(b,c,d);return-1!==Object.keys(this._data).indexOf(e)?e:!1},clear:function(){this._data={}}}),h=c.Class.extend({init:function(a){this._name=this._name||a.reader,this._data=a.data||[],this._basepath=this._basepath||a.path||null},read:function(a,b){return new e.resolve(this._data)},getData:function(){return this._data}});f=h._collection,c.Reader=h,c.Data=g}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils,d=!1,e=[],f={},g=b.Class.extend({init:function(a,b){this._id=this._id||c.uniqueId("e"),this._events={},this._freeze=!1,this._freezer=[],this._freezeExceptions={}},on:function(a,b){var d;if(c.isArray(b))for(d=0;d<b.length;d++)this.on(a,b[d]);else if(c.isArray(a))for(d=0;d<a.length;d++)this.on(a[d],b);else if(c.isObject(a))for(d in a)this.on(d,a[d]);else this._events[a]=this._events[a]||[],"function"==typeof b?this._events[a].push(b):c.warn("Can't bind event '"+a+"'. It must be a function.")},unbind:function(a){if(c.isArray(a))for(var b=0;b<a.length;b++)this.unbind(a[b]);else this._events.hasOwnProperty(a)&&(this._events[a]=[])},unbindAll:function(){this._events={}},trigger:function(a,b,g){var h;if(c.isArray(a))for(h=0,size=a.length;h<size;h++)this.trigger(a[h],b);else{if(!this._events.hasOwnProperty(a))return;for(h=0;h<this._events[a].length;h++){var i=this._events[a][h],j=this,k=function(){var d="Vizabi Event: "+a+" - "+g;c.timeStamp(d),i.apply(j,[g||a,b])};this._freeze||d?d&&f.hasOwnProperty(a)||!d&&this._freeze&&this._freezeExceptions.hasOwnProperty(a)?k():(this._freezer.push(k),d&&!e[this._id]&&(this.freeze(),e[this._id]=this)):k()}}},triggerAll:function(a,b){if(c.isArray(a))for(var d=0,e=a.length;e>d;d++)this.triggerAll(a[d],b);else for(var f=a,g=a.split(":");g.length;)this.trigger(a,b,f),g.pop(),a=g.join(":")},freeze:function(a){if(this._freeze=!0,a){c.isArray(a)||(a=[a]);for(var b=0;b<a.length;b++)this._freezeExceptions[a[b]]=!0}},unfreeze:function(){for(this._freeze=!1,this._freezeExceptions={};this._freezer.length;){var a=this._freezer.shift();a()}}});g.freezeAll=function(a){d=!0,a&&(c.isArray(a)||(a=[a]),c.forEach(a,function(a){f[a]=!0}))},g.unfreezeAll=function(){d=!1,f={};for(var a in e){var b=e[a];b.unfreeze(),delete e[a]}},b.Events=g}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=(b.utils,b.Class.extend({init:function(){this.intervals={}},setInterval:function(a,b,c){this.clearInterval(a),this.intervals[a]=setInterval(b,c)},clearInterval:function(a){return a?clearInterval(this.intervals[a]):this.clearAllIntervals()},clearAllIntervals:function(){for(var a in this.intervals)this.clearInterval(a)}}));b.Intervals=c}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils,d="vzb-",e="vzb-portrait",f="vzb-landscape",g={small:{min_width:0,max_width:749},medium:{min_width:750,max_width:969},large:{min_width:970,max_width:1/0}},h=b.Events.extend({init:function(){this._container=null,this._curr_profile=null,this._prev_size={};var b=this;a.addEventListener("resize",function(){b.container&&b.setSize()}),this._super()},setSize:function(){var a=this,b=this._container.clientWidth,h=this._container.clientHeight;this._prev_size&&this._prev_size.width===b&&this._prev_size.height===h||(c.forEach(g,function(e,f){c.removeClass(a._container,d+f),b>=e.min_width&&b<=e.max_width&&(a._curr_profile=f)}),c.addClass(this._container,d+this._curr_profile),h>b?(c.addClass(this._container,e),c.removeClass(this._container,f)):(c.addClass(this._container,f),c.removeClass(this._container,e)),this._prev_size.width=b,this._prev_size.height=h,this.trigger("resize"))},setContainer:function(a){this._container=a,this.setSize()},currentProfile:function(){return this._curr_profile}});b.Layout=h}.call(this),function(){"use strict";function a(a){return a.hasOwnProperty("_data")}function b(a){for(var b in a._data)Object.defineProperty(a,b,{configurable:!0,get:function(b){return function(){return a.get(b)}}(b),set:function(b){return function(c){return a.set(b,c)}}(b)})}function c(b,c,d){var e=b.split("_")[0],f={set:function(a,b){},init:function(a,b){},change:function(a,b){a=a.replace("change","change:"+e),d.triggerAll(a,d.getObject())},load_start:function(a,b){a=a.replace("load_start","load_start:"+e),d.triggerAll(a,d.getObject())},load_error:function(a,b){a=a.replace("load_error","load_error:"+e),d.triggerAll(a,b)},ready:function(a,b){a=a.replace("ready","ready:"+e),d.trigger(a,b),d.setReady()}};if(a(c))return c.on(f),c;var g=j.Model.get(e,!0)||o;return new g(c,d,f)}function d(a){return a._intervals?a._intervals:a._parent?d(a._parent):new j.Intervals}function e(a,b){var c=f(a,b);return c?c:a._parent?e(a._parent,b):void 0}function f(b,c){for(var d in b._data)if(d===c&&a(b._data[d]))return b._data[d]}function g(a){return l.isArray(a.dimensions)?a.dimensions:a._parent?g(a._parent):void l.error('ERROR: dimensions not found.\n You must specify the objects this hook will use under the dimensions attribute in the state.\n Example:\n dimensions: ["entities", "time"]')}function h(a,b,c,d){if(null==a._items||0==a._items.length)return l.warn("interpolateValue returning NULL because items array is empty"),null;var e=new Date(b.time);delete b.time;var f=a._getFilteredItems(b);if("value"==c)return f[0][a[n]];var g=d3.bisectLeft(f.map(function(a){return a.time}),e);if("property"==c&&0==g)return f[0][d];if("property"==c)return f[g-1][d];if(0==g)return f[0][d];if(g==f.length)return f[f.length-1][d];if(null==f[g][d]||null==f[g-1][d])return null;var h=(e-f[g-1].time)/(f[g].time-f[g-1].time),d=+f[g-1][d]+(f[g][d]-f[g-1][d])*h;return"[object Date]"===Object.prototype.toString.call(f[0][d])&&(d=new Date(d)),d}var i=this,j=i.Vizabi,k=j.Promise,l=j.utils,m="use",n="value";j._require("d3");var o=j.Events.extend({init:function(a,b,c){this._type=this._type||"model",this._id=this._id||l.uniqueId("m"),this._data={},this._parent=b,this._set=!1,this._ready=!1,this._readyOnce=!1,this._loadedOnce=!1,this._loading=[],this._intervals=d(this),this._deps={parent:[],children:[]},this._hooks={},this._items=[],this._unique={},this._filtered={},this._limits={},this._super(),c&&this.on(c),a&&this.set(a)},get:function(a){return a?this._data[a]:this._data},set:function(d,e,f){var g,h=[],i=this._setting,j=this;l.isPlainObject(d)?(g=d,f=e):(g={})[d]=e,i||(this._prevData=l.clone(this._data),this._changedData={}),this._setting=!0,this.setReady(!1);for(var k in g){var e=g[k],m=this._data[k],n=this._prevData[k];if(!l.isPlainObject(e)||l.isArray(e)){if(m!==e||f||JSON.stringify(m)!==JSON.stringify(e)){var o="undefined"==typeof m?"init":"change";h.push(o+":"+k)}n!==e||f||JSON.stringify(n)!==JSON.stringify(e)?this._changedData[k]=e:delete this._changedData[k],this._data[k]=e}else m&&a(m)?(h.push("change:"+k),this._data[k].set(e,f)):(h.push("init:"+k),this._data[k]=c(k,e,this))}b(this),this.validate&&!i&&this.validate(),(!i||f)&&(this._set?h.length&&h.push("change"):(this._set=!0,h.push("set")),j.triggerAll(h,j.getObject()),j._setting=!1,this.isHook()||this.setReady())},getType:function(){return this._type},getSubmodels:function(){var a=[];return l.forEach(this._data,function(b){b&&"undefined"!=typeof b._id&&a.push(b)}),a},getObject:function(){var a={};for(var b in this._data)this._data[b]&&"function"==typeof this._data[b].getObject?a[b]=this._data[b].getObject():a[b]=this._data[b];return a},clear:function(){var a=this.getSubmodels();for(var b in a)a[b].clear();this.setReady(!1),this.unbindAll(),this._intervals.clearAllIntervals(),this._data={}},validate:function(){},isLoading:function(a){if(this.isHook()&&!this._loadedOnce)return!0;if(a)return-1!==this._loading.indexOf(a);if(this._loading.length>0)return!0;var b,c=this.getSubmodels();for(b=0;b<c.length;b++)if(c[b].isLoading())return!0;for(b=0;b<this._deps.children.length;b++){var d=this._deps.children[b];if(d.isLoading()||!d._ready)return!0}return!1},setLoading:function(a){this.isLoading()||this.trigger("load_start"),this._loading.push(a)},setLoadingDone:function(a){this._loading=l.without(this._loading,a),this.setReady()},setReady:function(a){if(a===!1)return this._ready=!1,void(this._parent&&this._parent.setReady&&this._parent.setReady(!1));if(this._ready=!this.isLoading()&&!this._setting&&!this._loadCall,this._ready){this._readyOnce||(this._readyOnce=!0,this.trigger("readyOnce")),this.trigger("ready");for(var b=0;b<this._deps.parent.length;b++)this._deps.parent[b].setReady()}},load:function(){var a=this,b=this.getSubmodels(),c=this._dataModel,d=this._languageModel,e=this.getQuery(),f=new k,g=[];if(this._loadCall=!0,this.isHook()&&c&&e){var h=c.getObject(),i=d?d.id:"en",m=new k,n={load_start:function(){a.setLoading("_hook_data"),j.Events.freezeAll(["load_start","resize","dom_ready"])},load_end:function(){j.Events.unfreezeAll(),a.setLoadingDone("_hook_data")}};l.timeStamp("Vizabi Model: Loading Data: "+a._id),this._dataManager.load(e,i,h,n).then(function(b){a._items=b,l.timeStamp("Vizabi Model: Data loaded: "+a._id),a._unique={},a._filtered={},a._limits={},a.afterLoad(),m.resolve()},function(b){a.trigger("load_error",e),m.reject(b)}),g.push(m)}for(var o in b)g.push(b[o].load());var p=g.length?k.all(g):new k.resolve;return p.then(function(){a.validate&&a.validate(),l.timeStamp("Vizabi Model: Model loaded: "+a._id),a._loadedOnce=!0,a._loadCall=!1,a.setReady(),f.resolve()}),f},afterLoad:function(){},resetDeps:function(){this._deps.children=[]},addDep:function(a){this._deps.children.push(a),a._deps.parent.push(this)},isHook:function(){return this[m]?!0:!1},setHooks:function(){this.isHook()&&(this.dimensions=g(this),this.hookModel());var a=this.getSubmodels();l.forEach(a,function(a){a.setHooks()})},hookModel:function(){var a=this;this._dataManager=new j.Data,this._dataModel=e(this,"data"),this._languageModel=e(this,"language"),l.forEach(this.dimensions,function(b){a._hooks[b]=e(a,b),a._hooks[b].show&&a._hooks[b].on("change:show",function(b){a.load()})}),this.on("change",function(){a.load()})},getHook:function(a){return this._hooks[a]},getHookValues:function(a){var b=[];return this[m]&&this[m]===a&&b.push(this[n]),l.forEach(this.getSubmodels(),function(c){b=l.unique(b.concat(c.getHookValues(a)))}),b},getIndicators:function(){return this.getHookValues("indicator")},getProperties:function(){return this.getHookValues("property")},getAllDimensions:function(){var a,b=[];return l.forEach(this._hooks,function(c){(a=c.getDimension())&&b.push(a)}),b},getAllFilters:function(){var a={};return l.forEach(this._hooks,function(b){a=l.extend(a,b.getFilter())}),a},getValue:function(a){var b=l.clone(a,this.getAllDimensions());return this.mapValue(this._getHookedValue(b))},getValues:function(a){var b=l.clone(a,this.getAllDimensions());return this._getHookedValues(b)},mapValue:function(a){return a},getItems:function(a){if(this.isHook()&&this._dataModel){var b=l.without(this.getAllDimensions(),"time");return this.getUnique(b).map(function(b){return a&&a.time&&(b.time=a.time),b})}return[]},getDimension:function(){return!1},getFilter:function(){return{}},getQuery:function(){var a=["property","indicator"];if(this.isHook()&&-1!==a.indexOf(this[m])){if(Object.keys(this._hooks).length<1)return l.error("Error:",this._id,"can't find any dimension"),[];var b=this.getAllDimensions(),c=l.unique(b.concat([this[n]])),d=this.getAllFilters();return{from:"data",select:c,where:d}}return[]},getScale:function(){return null==this.scale&&this.buildScale(),this.scale},buildScale:function(){if(this.isHook()){var a,b=this.scaleType||"linear";switch(this.use){case"indicator":var c=this.getLimits(this[n]);a=[c.min,c.max];break;case"property":a=this.getUnique(this[n]);break;case"value":default:a=[this[n]]}this.scale=d3.scale[b]().domain(a)}},getLimits:function(a){if(this.isHook()){if(a||(a="time"),this._limits[a])return this._limits[a];var b={min:0,max:0},c=this._items.map(function(b){return"time"!==a?parseFloat(b[a]):new Date(b[a].toString())});return c.length>0&&(b.min=Math.min.apply(null,c),b.max=Math.max.apply(null,c)),this._limits[a]=b,b}},getUnique:function(a){if(!l.isArray(a))return this.getUnique([a]);if(this.isHook()){a||(a="time");var b,c=JSON.stringify(a);if(this._unique[c])return this._unique[c];var d=this._items.map(function(b){return l.clone(b,a)});if(-1!==a.indexOf("time"))for(var e=0;e<d.length;e++)d[e].time=new Date(d[e].time);return b=l.unique(d,function(a){return JSON.stringify(a)}),this._unique[c]=b,b}},_getHookedValue:function(a){if(!this.isHook())return void l.warn("_getHookedValue method needs the model to be hooked to data.");var b;return b="value"===this[m]?this[n]:this._hooks.hasOwnProperty(this[m])?this.getHook(this[m])[this[n]]:h(this,a,this[m],this[n])},_getHookedValues:function(a){var b=this;if(!this.isHook())return void l.warn("_getHookedValue method needs the model to be hooked to data.");var c;if("value"===this[m])c=[this[n]];else if(this._hooks.hasOwnProperty(this[m]))c=[this.getHook(this[m])[this[n]]];else if(a&&a.hasOwnProperty("time")){var d=new Date(a.time),e=_interpolateValue(this,a,this[m],this[n]);c=l.filter(this._items,a).filter(function(a){return a.time<=d}).map(function(a){return a[b[n]]}).concat(e)}else c=this._items.filter(a).map(function(a){return a[b[n]]});return c},getMaxMinMean:function(a){var b=this,c={};return d3.nest().key(function(b){return a(b.time)}).entries(b._items).forEach(function(a){var d=a.values.filter(function(a){return null!=a[b[n]]}).map(function(a){return+a[b[n]]});c[a.key]={max:d3.max(d),min:d3.min(d),mean:d3.mean(d)}}),c},_getFilteredItems:function(a){var b=(JSON.stringify(a),JSON.stringify(a));return this._filtered[b]?this._filtered[b]:this._filtered[b]=l.filter(this._items,a)}});j.Model=o}.call(this),function(){"use strict";function a(b,d){var e=/<[a-z][\s\S]*>/i.test(b)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+b.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):f[b]=f[b]||a(c.document.getElementById(b).innerHTML);return d?e(d):e}var b="vzb-loading",c=this,d=c.Vizabi,e=d.utils,f={},g=d.Events.extend({init:function(a,b){if(this._id=this._id||e.uniqueId("c"),this._ready=!1,this._readyOnce=!1,this.name=this.name||a.name,this.template=this.template||"<div></div>",this.placeholder=this.placeholder||a.placeholder,this.template_data=this.template_data||{name:this.name},this.placeholder&&!e.isElement(this.placeholder))try{this.placeholder=b.placeholder.querySelector(this.placeholder)}catch(c){e.error("Error finding placeholder '"+this.placeholder+"' for component '"+this.name+"'")}this.parent=b||this,this.components=this.components||[],this._components_config=this.components.map(function(a){return e.clone(a)}),this._frameRate=10,this.model_expects=this.model_expects||[],this.model_binds=this.model_binds||{},this.ui=this.ui||a.ui,this._super();var d=this;this.on({dom_ready:function(){"function"==typeof d.domReady&&d.domReady()},ready:function(){"function"==typeof d.ready&&d.ready()},resize:function(){"function"==typeof d.resize&&d.resize()}})},render:function(){function a(){c.trigger("dom_ready"),e.removeClass(c.placeholder,b),c._ready=!0,c._readyOnce||(c._readyOnce=!0),c.trigger("ready")}var c=this;this.loadTemplate(),this.loadComponents(),e.forEach(this.components,function(a){a.render(),c.on("resize",function(){a.trigger("resize")})}),this.isRoot()&&this.model?(this.model.on("ready",function(){a()}),this.model.setHooks(),this.model.load()):a()},loadTemplate:function(){var c=this.template,d=this.template_data,f=this,g="";if(this.placeholder){if(this.template)try{g=a(c,d)}catch(h){e.error("Templating error for component: '"+this.name+"' - Check if path to template is correct. E.g.: 'src/components/...'")}e.addClass(this.placeholder,b),this.placeholder.innerHTML=g,this.element=this.placeholder.children[0],this.layout&&(this.layout.setContainer(this.placeholder),this.layout.on("resize",function(){f._ready&&e.throttle(function(){f.trigger("resize")},f._frameRate)}))}},loadComponents:function(){var a,b,c=this;this.components=[],this.model&&this.model.resetDeps(),e.forEach(this._components_config,function(f){if(!f.component)return void e.error("Error loading component: name not provided");if(b=d.Component.get(f.component)){a=e.extend(f,{name:f.component,ui:c._uiMapping(f.placeholder,f.ui)});var g=new b(a,c),h=f.model||[];g.model=c._modelMapping(g.name,h,g.model_expects,g.model_binds),c.model&&c.model.addDep(g.model),c.components.push(g)}})},isRoot:function(){return this.parent===this},getLayoutProfile:function(){return this.layout?this.layout.currentProfile():this.parent.getLayoutProfile()},_uiMapping:function(a,b){if(b)return new d.Model(b);if(a&&this.ui){a=a.replace(".","");var c=this.ui[a];if(c)return c}return this.ui},_modelMapping:function(a,b,c,f){function g(){var a=m.getSubmodels();for(var b in m.get())"undefined"!=typeof m[b]._id&&!function(b,c){b[c].on({set:function(d,f){d=d.replace("set","set:"+c),b.trigger(d,f);var g=!0;e.forEach(a,function(a){a._set!==!0&&(g=!1)}),g&&b.trigger("set",f)},init:function(a,d){a=a.replace("init","init:"+c),b.triggerAll(a,b.getObject())},change:function(a,d){a=a.replace("change","change:"+c),b.triggerAll(a,b.getObject())},load_start:function(a,d){a=a.replace("load_start","load_start:"+c),b.triggerAll(a,d)},load_error:function(a,d){a=a.replace("load_error","load_error:"+c),b.triggerAll(a,d)},ready:function(a,d){a=a.replace("ready","ready:"+c),b.trigger(a,d),b.setReady()}})}(m,b)}function h(a){for(var b=a.split("."),c=i.model,d="";b.length;)d=b.shift(),c=c[d];return{name:a,model:c,type:c.getType()}}var i=this,j={};if(e.isArray(b)&&e.isArray(c)){c.length!==b.length&&(e.groupCollapsed("DIFFERENCE IN NUMBER OF MODELS EXPECTED AND RECEIVED"),e.warn("Please, configure the 'model_expects' attribute accordingly in '"+a+"' or check the models passed in '"+this.name+"'. [ADD LINK TO DOCUMENTATION]\n\nComponent: '"+this.name+"'\nSubcomponent: '"+a+"'\nNumber of Models Expected: "+c.length+"\nNumber of Models Received: "+b.length),e.groupEnd()),e.forEach(b,function(d,f){var g,i=h(d);c[f]?(g=c[f].name,c[f].type&&i.type!==c[f].type&&(e.groupCollapsed("UNEXPECTED MODEL TYPE: '"+i.type+"' instead of '"+c[f].type+"'"),e.warn("Please, configure the 'model_expects' attribute accordingly in '"+a+"' or check the models passed in '"+this.name+"'. [ADD LINK TO DOCUMENTATION]\n\nComponent: '"+this.name+"'\nSubcomponent: '"+a+"'\nExpected Model: '"+c[f].type+"'\nReceived Model'"+i.type+"'\nModel order: "+f),e.groupEnd())):(e.groupCollapsed("UNEXPECTED MODEL: '"+b[f]+"'"),e.warn("Please, configure the 'model_expects' attribute accordingly in '"+a+"' or check the models passed in '"+this.name+"'. [ADD LINK TO DOCUMENTATION]\n\nComponent: '"+this.name+"'\nSubcomponent: '"+a+"'\nNumber of Models Expected: "+c.length+"\nNumber of Models Received: "+b.length),e.groupEnd(),g=i.name),j[g]=i.model});var k=b.length,l=c.length;l>k&&(c.splice(0,k),e.forEach(l,function(a){j[a.name]={}}));var m=new d.Model(j,null,f);return g(),m}},getTranslationFunction:function(a){var b;try{b=this.model.get("language").getTFunction()}catch(c){this.parent&&this.parent!=this&&(b=this.parent.getTranslationFunction())}return b||(b=function(a){return a}),a?this._translatedStringFunction(b):b},_translatedStringFunction:function(a){return function(b){var c=a(b);return'<span data-vzb-translate="'+b+'">'+c+"</span>"}},translateStrings:function(){var a=this.getTranslationFunction(),b=this.placeholder.querySelectorAll("[data-vzb-translate]");e.forEach(b,function(b){b.innerHTML=a(b.getAttribute("data-vzb-translate"))})},isTool:function(){return"t"===this._id[0]},domReady:function(){},ready:function(){},resize:function(){}});g.isComponent=function(a){return a._id&&("t"===a._id[0]||"c"===a._id[0])},d.Component=g}.call(this),function(){"use strict";function a(a,b){function c(){var e=JSON.stringify(a.getObject()),f=arguments[0]||0;this._readyOnce?b():b(this);var g=JSON.stringify(a.getObject());f>=d?h.error("Max validation loop."):e!==g&&c.call(this,[++f])}var d=10;return c}function b(a,c){for(var d in c){var e=c[d],f=a[d],g=h.isObject(e)?e._type_:null,i=h.isObject(e)?e._defs_:null,j=h.isObject(e)?e._opts_:null;g?("number"===g&&isNaN(f)?a[d]=isNaN(i)?0:i:"string"===g&&"string"!=typeof f?a[d]="string"==typeof i?i:"":"array"!==g||h.isArray(f)?"object"!==g||h.isObject(f)?("model"===g||"hook"===g)&&(h.isObject(f)||(a[d]={}),a[d]=b(a[d],i)):a[d]=h.isObject(i)?i:{}:a[d]=h.isArray(i)?i:[],h.isArray(j)&&i&&-1===j.indexOf(a[d])&&(h.warn("Vizabi options contain invalid value for '"+d+"'. Permitted values: "+JSON.stringify(j)+". Changing to default"),a[d]=i)):"undefined"==typeof f?a[d]=e:h.isObject(e)&&h.isObject(f)&&(a[d]=b(f,e))}return a}var c="vzb-loading",d="vzb-loading-error",e="vzb-placeholder",f=this,g=f.Vizabi,h=g.utils,i=g.Model.extend({init:function(c,d,e,f){if(this._id=h.uniqueId("tm"),this._type="tool",this.validate=a(this,f),c=b(c,d),this._super(c,null,e),c.language){var g=this;this.on("change:language",function(){g.trigger("translate")})}}}),j=g.Component.extend({init:function(a,b){this._id=h.uniqueId("t"),this.layout=new g.Layout,this.template=this.template||'<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-content"><div class="vzb-tool-stage"><div class="vzb-tool-viz"></div><div class="vzb-tool-timeslider"></div></div><div class="vzb-tool-buttonlist"></div></div></div>',this.model_binds=this.model_binds||{},this.default_options=this.default_options||{};var c=this.validate.bind(this),d=this,f=h.merge({change:function(a,b){d._ready&&(d.model.validate(),d.triggerAll(a,b))},translate:function(a,b){d._ready&&d.model.load().then(function(){d.model.validate(),d.translateStrings()})},load_start:function(){d.beforeLoading()},load_error:function(){d.errorLoading()},ready:function(a){d._ready&&d.afterLoading()}},this.model_binds);this.model=new i(b,this.default_options,f,c),this.ui=this.model.ui,this._super({name:this.name||this._id,placeholder:a},this),h.addClass(this.placeholder,e),this._bindEvents(),this.render()},_bindEvents:function(){this.model.bind&&this.on(this.model.bind.get())},setOptions:function(a,b,c){b?this.model.reset(a):this.model.set(a)},beforeLoading:function(){h.hasClass(this.placeholder,c)||h.addClass(this.placeholder,c)},afterLoading:function(){h.removeClass(this.placeholder,c)},errorLoading:function(){h.addClass(this.placeholder,d)},validate:function(){}});j.isTool=function(a){return a._id&&"t"===a._id[0]},g.Tool=j}.call(this),function(){var a=this,b=a.document.createElement("script");b.type="text/template",b.setAttribute("id","src/components/_gapminder/timeslider/timeslider.html"),b.innerHTML='<div class="vzb-timeslider"> <div class="vzb-ts-slider-wrapper"> <svg class="vzb-ts-slider"> <g> <g class="vzb-ts-slider-axis"></g> <g class="vzb-ts-slider-slide"> <circle class="vzb-ts-slider-handle"></circle> <text class="vzb-ts-slider-value"></text> </g> </g> </svg> </div>  <div class="vzb-ts-btns"> <button class="vzb-ts-btn-play vzb-ts-btn"> <svg class="vzb-icon vzb-icon-play" width="1792" height="1792" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1576 927l-1328 738q-23 13-39.5 3t-16.5-36v-1472q0-26 16.5-36t39.5 3l1328 738q23 13 23 31t-23 31z"/></svg> </button> <button class="vzb-ts-btn-pause vzb-ts-btn"> <svg class="vzb-icon vzb-icon-pause" width="1792" height="1792" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1664 192v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45zm-896 0v1408q0 26-19 45t-45 19h-512q-26 0-45-19t-19-45v-1408q0-26 19-45t45-19h512q26 0 45 19t19 45z"/></svg> </button> </div> </div>',
a.document.body.appendChild(b)}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=(b.Promise,b.utils);if(b._require("d3")){var d="vzb-playing",e="vzb-ts-hide-play-button",f="vzb-ts-dragging",g="vzb-ts-axis-aligned",h="vzb-ts-show-value",i="vzb-ts-show-value-when-drag-play",j={year:d3.time.format("%Y"),month:d3.time.format("%b"),week:d3.time.format("week %U"),day:d3.time.format("%d/%m/%Y"),hour:d3.time.format("%d/%m/%Y %H"),minute:d3.time.format("%d/%m/%Y %H:%M"),second:d3.time.format("%d/%m/%Y %H:%M:%S")},k={small:{margin:{top:9,right:15,bottom:10,left:15},radius:8,label_spacing:10},medium:{margin:{top:9,right:15,bottom:10,left:15},radius:10,label_spacing:12},large:{margin:{top:9,right:15,bottom:10,left:15},radius:11,label_spacing:14}};b.Component.extend("gapminder-timeslider",{init:function(a,b){this.template=this.template||"src/components/_gapminder/timeslider/timeslider.html",this.model_expects=[{name:"time",type:"time"}];var d=this;this.model_binds={change:function(a,b){d.changeTime(),d._setHandle(d.model.time.playing)}},this.ui=c.extend({show_limits:!1,show_value:!1,show_value_when_drag_play:!0,show_button:!0,class_axis_aligned:!1},a.ui,this.ui),this._super(a,b),this.width=0,this.height=0},domReady:function(){var a=this;this.element=d3.select(this.element),this.slider_outer=this.element.select(".vzb-ts-slider"),this.slider=this.slider_outer.select("g"),this.axis=this.element.select(".vzb-ts-slider-axis"),this.slide=this.element.select(".vzb-ts-slider-slide"),this.handle=this.slide.select(".vzb-ts-slider-handle"),this.valueText=this.slide.select(".vzb-ts-slider-value"),this.xScale=d3.time.scale().clamp(!0),this.xAxis=d3.svg.axis().orient("bottom").tickSize(0),this.valueText.attr("text-anchor","middle").attr("dy","-1em");var b=a._getBrushed(),c=a._getBrushedEnd();this.brush=d3.svg.brush().x(this.xScale).extent([0,0]).on("brush",b).on("brushend",c),this.slide.call(this.brush),this.slide.selectAll(".extent,.resize").remove();var a=this},ready:function(){var a=this.element.select(".vzb-ts-btn-play"),b=this.element.select(".vzb-ts-btn-pause"),c=this;a.on("click",function(){c.model.time.play()}),b.on("click",function(){c.model.time.pause()}),this.changeTime(),this._setHandle(this.model.time.playing)},changeTime:function(){this.ui.format=this.model.time.unit;var a=(this.model.time.value,this.model.time.start),b=this.model.time.end;this.format=j[this.ui.format],this.xScale.domain([a,b]),this.xAxis.tickValues([a,b]).tickFormat(this.format),this._optionClasses(),this.resize()},resize:function(){this.profile=k[this.getLayoutProfile()];var a=parseInt(this.slider_outer.style("width"),10),b=parseInt(this.slider_outer.style("height"),10);this.width=a-this.profile.margin.left-this.profile.margin.right,this.height=b-this.profile.margin.bottom-this.profile.margin.top;this.slider.attr("transform","translate("+this.profile.margin.left+","+this.profile.margin.top+")"),(this.xScale.range()[1]=1)&&this.xScale.range([0,this.width]),this.xAxis=this.xAxis.scale(this.xScale).tickPadding(this.profile.label_spacing),this.axis.attr("transform","translate(0,"+this.height/2+")").call(this.xAxis),this.slide.select(".background").attr("height",this.height),this.handle.attr("transform","translate(0,"+this.height/2+")").attr("r",this.profile.radius)},getSetProfile:function(a){return arguments.length?(k=a,this):k},getSetScaleRangeMax:function(a){return arguments.length?(this.xScale.range([0,a]),this):this.xScale.range()[1]},_getBrushed:function(){var a=this;return function(){a._blockUpdate||(a.model.time.pause(),a._optionClasses(),a._blockUpdate=!0,a.element.classed(f,!0));var b=a.brush.extent()[0];d3.event.sourceEvent&&(b=a.xScale.invert(d3.mouse(this)[0])),b-a.model.time.value!==0&&a._setTime(b),a._setHandle()}},_getBrushedEnd:function(){var a=this;return function(){a._blockUpdate=!1,a.model.time.pause(),a.element.classed(f,!1),a.model.time.snap()}},_setHandle:function(a){var b=this.model.time.value;if(this.slide.call(this.brush.extent([b,b])),this.valueText.text(this.format(b)),this.model.time.start-this.model.time.value===0&&(a=!1),a){var c=this.model.time.speed,d=this.handle.attr("cx"),e=this.xScale(b);this.handle.attr("cx",d).transition().duration(c).ease("linear").attr("cx",e),this.valueText.attr("transform","translate("+d+","+this.height/2+")").transition().duration(c).ease("linear").attr("transform","translate("+e+","+this.height/2+")")}else{var f=this.xScale(b);this.handle.attr("cx",f),this.valueText.attr("transform","translate("+f+","+this.height/2+")")}},_setTime:function(a){var b=this,c=50,d=new Date;null!=this._updTime&&d-this._updTime<c||(this._updTime=d,b.model.time.value=a)},_optionClasses:function(){var a=this.ui.show_limits,b=this.ui.show_value,c=this.ui.show_value_when_drag_play,f=this.ui.axis_aligned,j=this.ui.show_button&&this.model.time.playable;a||this.xAxis.tickValues([]).ticks(0),this.element.classed(e,!j),this.element.classed(d,this.model.time.playing),this.element.classed(h,b),this.element.classed(i,c),this.element.classed(g,f)}})}}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils;b.Model.extend("entities",{init:function(a,b,d){this._type="entities",a=c.extend({show:{},select:[],brush:[],opacityNonSelected:.3},a),this._visible=[],this._super(a,b,d)},validate:function(a){var b=this.getDimension(),c=this._visible.map(function(a){return a[b]});this.select=this.select.filter(function(a){return-1!==c.indexOf(a[b])}),this.brush=this.brush.filter(function(a){return-1!==c.indexOf(a[b])})},getDimension:function(){return this.show.dim},getFilter:function(){return this.show.filter.getObject()},getSelected:function(){var a=this.getDimension();return this.select.map(function(b){return b[a]})},selectEntity:function(a,b){var c=this.getDimension(),d=a[c];if(this.isSelected(a))this.select=this.select.filter(function(a){return a[c]!==d});else{var e={};e[c]=d,e.labelOffset=[0,0],b&&(e.trailStartTime=b(a.time)),this.select=this.select.concat(e)}},setLabelOffset:function(a,b){var d=this.getDimension(),e=a[d];c.find(this.select,function(a){return a[d]===e}).labelOffset=b,this.set("select",this.select,!0)},isSelected:function(a){var b=this.getDimension(),c=a[this.getDimension()],d=this.select.map(function(a){return a[b]});return-1!==d.indexOf(c)},clearSelected:function(){this.select=[]},highlightEntity:function(a,b){var c=this.getDimension(),d=a[c];if(!this.isHighlighted(a)){var e={};e[c]=d,b&&(e.trailStartTime=b(a.time)),this.brush=this.brush.concat(e)}},unhighlightEntity:function(a,b){var c=this.getDimension(),d=a[c];this.isHighlighted(a)&&(this.brush=this.brush.filter(function(a){return a[c]!==d}))},isHighlighted:function(a){var b=this.getDimension(),c=a[this.getDimension()],d=this.brush.map(function(a){return a[b]});return-1!==d.indexOf(c)},clearHighlighted:function(){this.brush=[]}})}.call(this),function(){"use strict";var a=this,b=a.Vizabi,c=b.utils;if(b._require("d3")){var d={year:d3.time.format("%Y"),month:d3.time.format("%Y-%m"),week:d3.time.format("%Y-W%W"),day:d3.time.format("%Y-%m-%d"),hour:d3.time.format("%Y-%m-%d %H"),minute:d3.time.format("%Y-%m-%d %H:%M"),second:d3.time.format("%Y-%m-%d %H:%M:%S")},e=Object.keys(d),f=c.values(d);b.Model.extend("time",{init:function(a,b,d){this._type="time",a=c.extend({value:"1800",start:"1800",end:"2014",playable:!0,playing:!1,loop:!1,round:!0,speed:500,unit:"year",format:"%Y",step:1,adaptMinMaxZoom:!1},a),this._super(a,b,d);var e=this;this._playing_now=!1,this.on({"change:playing":function(){e.playing===!0?e._startPlaying():e._stopPlaying()},set:function(){e.playing===!0&&e.set("playing",!0,!0),this.snap("start"),this.snap("end"),this.snap("value")}})},_formatToDates:function(){for(var a=["value","start","end"],b=0;b<a.length;b++){var d=a[b];if(!c.isDate(this[d]))for(var e=0;e<f.length;e++){var g=f[e],h=g.parse(this[d].toString());if(c.isDate(h)){this.set(d,h);break}}}},validate:function(){-1===e.indexOf(this.unit)&&(this.unit="year"),this.step<1&&(this.step="year"),c.isDate(this.start)&&c.isDate(this.end)&&c.isDate(this.value)||this._formatToDates(),this.end<this.start&&(this.end=this.start),this.value<this.start?this.value=this.start:this.value>this.end&&(this.value=this.end),this.playable===!1&&this.playing===!0&&(this.playing=!1)},play:function(){this.playing=!0},pause:function(){this.playing=!1},getRange:function(){return d3.time[this.unit].range(this.start,this.end,this.step)},getDimension:function(){return"time"},getFilter:function(){var a=d3.time.format(this.format||"%Y")(this.start),b=d3.time.format(this.format||"%Y")(this.end),c={time:[[a,b]]};return c},getFormatted:function(a,b){a||(a="%Y"),b||(b="value");var c=d3.time.format(a);return c(this[b])},snap:function(a){if(this.round){null==a&&(a="value");var b="round";"ceil"===this.round&&(b="ceil"),"floor"===this.round&&(b="floor");var c=d3.time[this.unit][b](this[a]);this.set(a,c,!0)}},_startPlaying:function(){if(this.playable&&!this._playing_now){this._playing_now=!0;var a=this,b=this.value,c=this.speed;this.snap(),a.end-b<=0&&(b=this.start,a.value=b),this._intervals.setInterval("playInterval_"+this._id,function(){return b>=a.end?void(a.loop?(b=a.start,a.value=b):a.playing=!1):(b=d3.time[a.unit].offset(b,a.step),void(a.value=b))},c),this.trigger("play")}},_stopPlaying:function(){this._playing_now=!1,this._intervals.clearInterval("playInterval_"+this._id),this.snap(),this.trigger("pause")}})}}.call(this),function(){"use strict";var a=this,b=a.Vizabi;b.Promise,b.utils;b._require("d3")&&b.Tool.extend("BarChart",{init:function(a,b){this.name="bar-chart",this.components=[{component:"_examples/bar-chart",placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","language"]},{component:"_gapminder/buttonlist",placeholder:".vzb-tool-buttonlist",model:["state","ui","language"],buttons:["fullscreen"]},{component:"_gapminder/timeslider",placeholder:".vzb-tool-timeslider",model:["state.time"]}],this.default_options={state:{_type_:"model",_defs_:{time:{_type_:"model",_defs_:{start:1952,end:2012,value:2e3,step:1,speed:300,formatInput:"%Y"}},entities:{_type_:"model",_defs_:{show:{_type_:"model",_defs_:{dim:{_type_:"string",_defs_:"geo"},filter:{_type_:"object",_defs_:{geo:["*"],"geo.category":["region"]}}}}}},marker:{_type_:"model",_defs_:{dimensions:{_type_:"array",_defs_:["entities","time"]},label:{_type_:"hook",_defs_:{use:{_type_:"string",_defs_:"property",_opts_:["property","indicator","value"]},value:{_type_:"string",_defs_:"geo.name"}}},axis_y:{_type_:"hook",_defs_:{use:{_type_:"string",_defs_:"indicator"},value:{_type_:"string",_defs_:"lex"},scaleType:{_type_:"string",_defs_:"linear"}}},axis_x:{_type_:"hook",_defs_:{use:{_type_:"string",_defs_:"property",_opts_:["property"]},value:{_type_:"string",_defs_:"geo.name"}}},color:{_type_:"hook",_defs_:{use:{_type_:"string",_defs_:"property"},value:{_type_:"string",_defs_:"geo.region"},palette:{_type_:"object",_defs_:{_default:"#ffb600",world:"#ffb600",eur:"#FFE700",afr:"#00D5E9",asi:"#FF5872",ame:"#7FEB00"}}}}}}}},data:{_type_:"model",_defs_:{reader:{_type_:"string",_defs_:"waffle-server"}}},ui:{_type_:"model",_defs_:{"vzb-tool-bar-chart":{_type_:"object",_defs_:{}}}},language:{_type_:"model",_defs_:{id:{_type_:"string",_defs_:"en"},strings:{_type_:"object",_defs_:{en:{title:"","buttons/expand":"Full screen","buttons/unexpand":"Leave full screen","buttons/lock":"Lock","buttons/find":"Find","buttons/colors":"Colors","buttons/size":"Size","buttons/more_options":"Options","indicator/lex":"Life expectancy","indicator/gdp_per_cap":"GDP per capita","indicator/pop":"Population","indicator/geo.region":"Region","indicator/geo":"Geo code","indicator/time":"","indicator/geo.category":"Geo category"}}}}}},this._super(a,b)},validate:function(a){a=this.model||a;var b=a.state.time,c=a.state.marker.label;if(c.getItems()&&!(c.getItems().length<1)){var d=c.getLimits("time").min,e=c.getLimits("time").max;b.start<d&&(b.start=d),b.end>e&&(b.end=e)}}})}.call(this);